<!DOCTYPE html>
<html>
<head>
<title>Jewels of Babylon: Routine at 50299</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="50288.html">50288</a>
</td>
<td class="up">Up: <a href="../maps/all.html#50299">Map</a></td>
<td class="next">
Next: <a href="50320.html">50320</a>
</td>
</tr>
</table>
<div class="description">50299: Parser: Validate Direct Object</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="50335.html">50335</a>, <a href="61853.html">Action_Examine</a>, <a href="62051.html">Action_Take</a>, <a href="62593.html">Action_Get</a>, <a href="62676.html">Action_DropThrow</a>, <a href="63771.html">Action_Climb</a>, <a href="63814.html">Action_Eat</a>, <a href="63897.html">Action_Drink</a>, <a href="63972.html">Action_Open</a>, <a href="64060.html">Action_CloseShut</a>, <a href="64168.html">Action_Shout</a>, <a href="64387.html">Action_Swearing</a>, <a href="64424.html">Action_Pull</a>, <a href="64469.html">Action_Wear</a>, <a href="64548.html">Action_LightStrike</a>, <a href="64609.html">Action_Enter</a>, <a href="64664.html">Action_Move</a>, <a href="64717.html">Action_Unlock</a> and <a href="64877.html">Action_Swim</a>.
</div>
<div class="paragraph">
In most adventure games, the structure for a command is "verb + direct object". This is usually how the player interacts with the game world. The verb describes the action, and the direct object is what the action is performed on. For example; "TAKE SHOE" uses the verb "TAKE" on the direct object "SHOE".
</div>
</div>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">F</td>
<td class="register-desc">The carry flag is set when the command is malformed</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="50299"></span>
<div class="comments">
<div class="paragraph">
The first token is the verb, so target the second token for the direct object.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Parser_ValidateDirectObject</td>
<td class="address-2"><span id="50299"></span>50299</td>
<td class="instruction">LD A,(48487)</td>
<td class="comment-1" rowspan="1">Fetch the <a href="48486.html#48487">second token from the user input</a> and store it in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50302"></span>50302</td>
<td class="instruction">CP 255</td>
<td class="comment-1" rowspan="2">Jump forward to <a href="50299.html#50311">DirectObject_Process</a> if the token is anything other than the terminator character (255).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50304"></span>50304</td>
<td class="instruction">JR NZ,<a href="50299.html#50311">DirectObject_Process</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="50306"></span>
<div class="comments">
<div class="paragraph">
The token was the terminator character (255), so the sentence is malformed.
</div>
<div class="paragraph">
E.g. They tried "TAKE" but didn't write anything after it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50306"></span>50306</td>
<td class="instruction">CALL <a href="49141.html">Response_PleaseBeMoreSpecific</a></td>
<td class="comment-1" rowspan="1">Call <a href="49141.html">Response_PleaseBeMoreSpecific</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50309"></span>50309</td>
<td class="instruction">SCF</td>
<td class="comment-1" rowspan="1">Set the carry flag to indicate this call was a failure.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50310"></span>50310</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="50311"></span>
<div class="comments">
<div class="paragraph">
Process the direct object.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DirectObject_Process</td>
<td class="address-2"><span id="50311"></span>50311</td>
<td class="instruction">CALL <a href="50094.html">Parser_CountItems</a></td>
<td class="comment-1" rowspan="1">Call <a href="50094.html">Parser_CountItems</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50314"></span>50314</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if <span class="register">A</span> is not equal to 255.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50315"></span>50315</td>
<td class="instruction">CALL <a href="49134.html">Response_PleaseRephraseThat</a></td>
<td class="comment-1" rowspan="1">Call <a href="49134.html">Response_PleaseRephraseThat</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50318"></span>50318</td>
<td class="instruction">SCF</td>
<td class="comment-1" rowspan="1">Set the carry flag to indicate the command is malformed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="50319"></span>50319</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="50288.html">50288</a>
</td>
<td class="up">Up: <a href="../maps/all.html#50299">Map</a></td>
<td class="next">
Next: <a href="50320.html">50320</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1985 Interceptor Software UK &copy; 2025 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/jewelsofbabylon/">Source code</a>.</div>
<div><a href="../../asm/C47B.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>